{% extends 'base.html' %}

{% block title %}
–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å
{% endblock %}

{% block body %}
<div class="container mt-5">
    <div class="jumbotron bg-light p-5 rounded shadow">
        <h1 class="display-4 text-primary">–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ VirusTotal Scanner!</h1>
        <p class="lead">
            –≠—Ç–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Å–æ–∑–¥–∞–Ω–æ –¥–ª—è –∏–∑—É—á–µ–Ω–∏—è —Ä–∞–±–æ—Ç—ã Flask –∏ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç —Å–ª–µ–¥—É—é—â–∏–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏:
        </p>
        <hr class="my-4">

        {% if user_info %}
        <div class="row mb-4">
            <div class="col-md-12">
                <div class="card shadow-sm">
                    <div class="card-body">
                        <h5 class="card-title">–ü—Ä–∏–≤–µ—Ç, {{ user_info['real_name'] }}!</h5>
                    </div>
                </div>
            </div>
        </div>
        {% endif %}

        <div class="row">
            <div class="col-md-4">
                <div class="card shadow-sm">
                    <div class="card-body">
                        <h5 class="card-title">–ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–æ–≤</h5>
                        <p class="card-text">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –∑–∞–≥—Ä—É–∂–∞—Ç—å —Ñ–∞–π–ª—ã –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞.</p>
                    </div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="card shadow-sm">
                    <div class="card-body">
                        <h5 class="card-title">–ê–Ω–∞–ª–∏–∑ —É–≥—Ä–æ–∑</h5>
                        <p class="card-text">–ö–∞–∂–¥—ã–π —Ñ–∞–π–ª –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –Ω–∞ VirusTotal API –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–∞ –≤—Ä–µ–¥–æ–Ω–æ—Å–Ω–æ–µ —Å–æ–¥–µ—Ä–∂–∞–Ω–∏–µ.</p>
                    </div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="card shadow-sm">
                    <div class="card-body">
                        <h5 class="card-title">–î–µ—Ç–∞–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h5>
                        <p class="card-text">–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –∞–Ω–∞–ª–∏–∑–∞ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è —Å —É–∫–∞–∑–∞–Ω–∏–µ–º —Ä–µ–ø—É—Ç–∞—Ü–∏–∏ —Ñ–∞–π–ª–∞ –∏ —Å—Ç–µ–ø–µ–Ω–∏ —É–≥—Ä–æ–∑—ã.</p>
                    </div>
                </div>
            </div>
        </div>
        <div class="mt-4">
            <h5><strong>–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏:</strong></h5>
            <ul>
                <li>–°–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ URL-–∞–¥—Ä–µ—Å–æ–≤ –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ –∏—Ö –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏.</li>
                <li>–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –ø–æ–¥—Ä–æ–±–Ω—ã—Ö –æ—Ç—á–µ—Ç–æ–≤ –æ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ —Ñ–∞–π–ª–æ–≤.</li>
                <li>–í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –∏ —Ç—Ä–µ–Ω–¥–æ–≤ –ø–æ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–º —Ñ–∞–π–ª–∞–º.</li>
            </ul>
            <a class="btn btn-primary btn-lg" href="/file/upload" role="button">–ù–∞—á–∞—Ç—å</a>
        </div>
    </div>
</div>

<!-- –ú–∏–Ω–∏-–æ–∫–æ—à–∫–æ —Å —á–∞—Ç–æ–º -->
<div class="chat-box" id="chatBox">
    <div class="chat-header" id="chatHeader">
        <span>–ß–∞—Ç —Å –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–æ–º</span>
        <button class="btn btn-sm btn-close" onclick="toggleChat()">‚úñ</button>
    </div>
    <div class="chat-body" id="chatBody">
        <div class="message assistant">Hi, welcome to chat with assistant! Text smth in English pleaseüòä</div>
    </div>
    <div class="chat-footer">
        <input type="text" id="chatInput" placeholder="–í–≤–µ–¥–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ..." onkeypress="handleKeyPress(event)">
        <button class="btn btn-primary btn-sm" onclick="sendMessage()">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
    </div>
</div>

<!-- –°–∫—Ä–∏–ø—Ç –¥–ª—è —Ä–∞–±–æ—Ç—ã —á–∞—Ç–∞ —á–µ—Ä–µ–∑ SocketIO -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.5.4/socket.io.js"></script>
<script>
    const socket = io();
    const chatBox = document.getElementById("chatBox");
    const chatHeader = document.getElementById("chatHeader");

    let isDragging = false;
    let startX, startY, startWidth, startHeight;

    function toggleChat() {
        chatBox.style.display = chatBox.style.display === "none" ? "flex" : "none";
    }

    function sendMessage() {
        const input = document.getElementById('chatInput');
        const message = input.value.trim();
        if (message) {
            const chatBody = document.getElementById('chatBody');
            chatBody.innerHTML += `<div class="message user">${message}</div>`;
            chatBody.scrollTop = chatBody.scrollHeight;

            socket.emit('message', message);
            input.value = '';
        }
    }

    function handleKeyPress(event) {
        if (event.key === 'Enter') {
            sendMessage();
        }
    }

    socket.on('message', function(data) {
        const chatBody = document.getElementById('chatBody');
        chatBody.innerHTML += `<div class="message assistant">${data}</div>`;
        chatBody.scrollTop = chatBody.scrollHeight;
    });

    // –ü–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏–µ —á–∞—Ç–∞
    chatHeader.addEventListener("mousedown", (e) => {
        isDragging = true;
        startX = e.clientX - chatBox.offsetLeft;
        startY = e.clientY - chatBox.offsetTop;

        document.addEventListener("mousemove", dragChat);
        document.addEventListener("mouseup", () => {
            isDragging = false;
            document.removeEventListener("mousemove", dragChat);
        });
    });

    function dragChat(e) {
        if (isDragging) {
            chatBox.style.left = e.clientX - startX + "px";
            chatBox.style.top = e.clientY - startY + "px";
        }
    }
</script>

{% endblock %}
